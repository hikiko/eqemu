#!/bin/sh

gen_module_init()
{
	# collect all src/file_whatever.c files
	modules=`ls src/file_*.c 2>/dev/null | sort | sed 's/src\/file_//' | sed 's/\.c//'`

	echo "/* this file is generated by $0, do not edit */"
	for m in $modules; do
		echo "int img_register_$m();"
	done

	echo
	echo 'void img_modules_init(void)'
	echo '{'

	for m in $modules; do
		echo "	img_register_$m();"
	done

	echo '}'
}

gen_module_init >src/modules.c

echo 'PREFIX = /usr/local' >Makefile
cat Makefile.in >>Makefile
